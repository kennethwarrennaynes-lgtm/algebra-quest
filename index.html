<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Quest: Ultimate Edition</title>
    <style>
        /* --- THEME: NEBULA PURPLE --- */
        :root {
            --primary: #6c5ce7;
            --primary-dark: #4834d4;
            --secondary: #a29bfe;
            --accent: #00cec9;
            --bg-dark: #2d3436;
            --bg-light: #f5f6fa;
            --text: #2d3436;
            --success: #00b894;
            --error: #d63031;
            --card-shadow: 0 8px 30px rgba(108, 92, 231, 0.2);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }

        body { display: flex; min-height: 100vh; background: var(--bg-light); color: var(--text); }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 300px; background: var(--bg-dark); color: white;
            padding: 20px; position: fixed; height: 100vh; overflow-y: auto;
            border-right: 5px solid var(--primary); z-index: 100;
        }

        .brand {
            font-size: 1.8em; font-weight: 800; text-align: center;
            color: var(--accent); text-transform: uppercase; letter-spacing: 2px;
            margin-bottom: 40px; cursor: pointer;
            text-shadow: 0 0 10px rgba(0, 206, 201, 0.5);
        }

        .nav-btn {
            display: block; width: 100%; padding: 15px 20px; margin-bottom: 10px;
            background: rgba(255,255,255,0.05); border: none; color: #b2bec3;
            text-align: left; cursor: pointer; border-radius: 10px; font-weight: 600;
            transition: 0.3s;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: white; padding-left: 25px; }
        .nav-btn.active { background: var(--primary); color: white; border-left: 5px solid var(--accent); }

        .xp-box {
            margin-top: 40px; background: rgba(0,0,0,0.3); padding: 20px;
            border-radius: 15px; text-align: center; border: 2px solid var(--accent);
        }

        /* --- MAIN CONTENT --- */
        .main-content { margin-left: 300px; flex: 1; padding: 40px; width: calc(100% - 300px); }

        .progress-bar {
            width: 100%; height: 8px; background: #dfe6e9; border-radius: 4px;
            margin-bottom: 20px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary));
            width: 0%; transition: width 0.5s ease;
        }

        /* --- PHASE NAV --- */
        .phase-nav {
            display: flex; gap: 10px; margin-bottom: 30px; visibility: hidden;
            background: white; padding: 15px; border-radius: 15px; box-shadow: var(--card-shadow);
        }
        .phase-nav.visible { visibility: visible; }

        .phase-btn {
            padding: 10px 20px; border: none; background: transparent; font-weight: 700;
            color: #636e72; cursor: pointer; border-radius: 20px; transition: 0.2s;
        }
        .phase-btn:hover { background: #f1f2f6; color: var(--primary); }
        .phase-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); }

        /* --- CONTENT CARD --- */
        .content-card {
            background: white; padding: 50px; border-radius: 25px;
            box-shadow: var(--card-shadow); min-height: 60vh;
            animation: fadeIn 0.5s ease; position: relative; padding-bottom: 100px;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        h1 { color: var(--primary-dark); font-size: 2.5em; margin-bottom: 20px; }
        h2 { color: var(--primary); border-bottom: 3px solid var(--secondary); padding-bottom: 10px; margin-bottom: 20px; }
        h3 { color: #2d3436; margin: 30px 0 15px 0; font-size: 1.4em; border-left: 5px solid var(--accent); padding-left: 10px; }
        p, li { line-height: 1.8; font-size: 1.1em; color: #444; margin-bottom: 15px; }

        /* --- MATH & INTERACTIVE --- */
        .math-text { font-family: 'Courier New', monospace; font-weight: bold; background: #eef; padding: 2px 6px; border-radius: 4px; color: var(--primary-dark); }
        
        .game-board {
            background: #f8f9fa; border: 3px dashed #b2bec3; border-radius: 20px;
            padding: 30px; text-align: center; margin: 20px 0;
        }

        .highlightable { 
            cursor: pointer; padding: 5px 10px; border-radius: 8px; border: 2px solid transparent; 
            transition: 0.2s; display: inline-block; font-size: 1.5em; font-family: 'Courier New', monospace; font-weight: bold;
        }
        .highlightable:hover { background: #dfe6e9; border-color: var(--primary); }
        .highlightable.selected { background: var(--success); color: white; border-color: var(--success); }

        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            border-radius: 50px; font-weight: bold; font-size: 1.1em; cursor: pointer;
            margin: 10px; transition: 0.3s; box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3);
        }
        .btn:hover { transform: translateY(-3px); background: var(--primary-dark); }
        .btn-outline { background: white; border: 2px solid var(--primary); color: var(--primary); }
        .btn-next { position: absolute; bottom: 40px; right: 40px; background: var(--success); }

        .feedback {
            margin-top: 20px; padding: 15px; border-radius: 10px; font-weight: bold;
            display: none; font-size: 1.2em;
        }
        .feedback.correct { background: #d4edda; color: #155724; display: block; }
        .feedback.wrong { background: #f8d7da; color: #721c24; display: block; }

        .video-container {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
            border-radius: 15px; margin: 30px 0; border: 4px solid var(--primary);
        }
        .video-container iframe { position: absolute; top:0; left:0; width: 100%; height: 100%; }

        /* --- QUIZ STYLES --- */
        .quiz-item { background: #f1f2f6; padding: 20px; border-radius: 15px; margin-bottom: 15px; }
        .quiz-opt { 
            display: block; background: white; padding: 15px; margin: 10px 0; 
            border: 2px solid #ddd; border-radius: 10px; cursor: pointer; transition: 0.2s;
        }
        .quiz-opt:hover { border-color: var(--primary); background: #eef; }

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand" onclick="loadHome()">ALGEBRA QUEST</div>
        
        <button class="nav-btn active" onclick="loadHome()">üè† Mission Control</button>
        <div style="margin: 20px 0; border-top: 1px solid rgba(255,255,255,0.1);"></div>
        
        <button id="nav-1" class="nav-btn" onclick="loadLessonIntro(1)">1. Anatomy of Algebra</button>
        <button id="nav-2" class="nav-btn" onclick="loadLessonIntro(2)">2. Language of Algebra</button>
        <button id="nav-3" class="nav-btn" onclick="loadLessonIntro(3)">3. Properties of Equality</button>
        <button id="nav-4" class="nav-btn" onclick="loadLessonIntro(4)">4. Solving Equations</button>

        <div class="xp-box">
            <div style="font-size:0.8em; text-transform:uppercase; color:#b2bec3;">Total XP</div>
            <div id="totalXP" style="font-size:2.5em; font-weight:800; color:var(--accent);">0</div>
        </div>
    </div>

    <div class="main-content">
        <div class="progress-bar"><div id="pBar" class="progress-fill"></div></div>
        
        <div id="phaseNav" class="phase-nav">
            <button class="phase-btn" onclick="setPhase('engage')">‚ú® Engage</button>
            <button class="phase-btn" onclick="setPhase('explore')">üîç Explore</button>
            <button class="phase-btn" onclick="setPhase('explain')">üìö Explain</button>
            <button class="phase-btn" onclick="setPhase('elaborate')">üöÄ Elaborate</button>
            <button class="phase-btn" onclick="setPhase('evaluate')">‚úÖ Evaluate</button>
        </div>

        <div id="contentArea" class="content-card"></div>
    </div>

<script>
    /* =========================================
       DATA STORE
       ========================================= */
    const content = {
        home: `
            <div style="text-align:center;">
                <h1 style="font-size:3em; color:var(--primary);">Welcome to Algebra Quest</h1>
                <hr style="width:50%; margin:30px auto; border:1px solid #ddd;">
            </div>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px;">
                <div>
                    <h3>üéØ Purpose</h3>
                    <p>This platform is designed to help you master the fundamentals of Algebra through interactive challenges. Instead of just reading, you will play, experiment, and solve.</p>
                    
                    <h3>üß† The 5E Model</h3>
                    <p>We use a special learning method to ensure you truly understand:</p>
                    <ul>
                        <li><strong>Engage:</strong> Hook your interest with a game.</li>
                        <li><strong>Explore:</strong> Hands-on activities to discover rules.</li>
                        <li><strong>Explain:</strong> Detailed videos and definitions.</li>
                        <li><strong>Elaborate:</strong> Harder problems and real-world use.</li>
                        <li><strong>Evaluate:</strong> A final quiz to test your skill.</li>
                    </ul>
                </div>
                <div style="background:#f8f9fa; padding:30px; border-radius:20px; border-left:5px solid var(--accent);">
                    <h3>üöÄ Your Mission</h3>
                    <p>Complete all 4 Levels to become an Algebra Master.</p>
                    <ul style="list-style:none; padding:0;">
                        <li style="margin-bottom:10px;"><strong>Level 1:</strong> Anatomy (Parts of expressions)</li>
                        <li style="margin-bottom:10px;"><strong>Level 2:</strong> Language (Translating English to Math)</li>
                        <li style="margin-bottom:10px;"><strong>Level 3:</strong> Properties (Rules of the game)</li>
                        <li style="margin-bottom:10px;"><strong>Level 4:</strong> Solving (Finding the unknown)</li>
                    </ul>
                    <button class="btn" style="width:100%" onclick="loadLessonIntro(1)">Start Level 1 ‚û°Ô∏è</button>
                </div>
            </div>
        `,
        lessons: {
            1: {
                title: "Anatomy of Algebra",
                intro: `
                    <h1>Level 1: Anatomy of Algebra</h1>
                    <p>A mathematician must study the parts of an equation like a doctor studies anatomy.</p>
                    <div style="background:#e1bee7; padding:20px; border-radius:15px; margin:20px 0;">
                        <h3>üéØ Objectives (Lesson 1)</h3>
                        <ul>
                            <li>Identify the <strong>terms</strong> in an algebraic expression.</li>
                            <li>Distinguish between <strong>variables</strong>, <strong>constants</strong>, and <strong>coefficients</strong>.</li>
                            <li>Determine the number of terms.</li>
                        </ul>
                    </div>
                    <button class="btn" onclick="startLesson(1)">Enter the Lab ‚û°Ô∏è</button>
                `,
                explain: `
                    <h2>üìö Explain: The Anatomy Charts</h2>
                    <div class="video-container"><iframe src="https://www.youtube.com/embed/_90sfL5XM_Q" allowfullscreen></iframe></div>
                    
                    <h3>1. Terms</h3>
                    <p>An algebraic expression is built from parts called <strong>terms</strong>. A term can be a number, a variable, or a product of both. Terms are separated by <span class="math-text">+</span> or <span class="math-text">-</span> signs. The sign belongs to the term immediately to its <em>left</em>.</p>
                    <p><em>Example:</em> <span class="math-text">3x - 5y + 7</span> has 3 terms (<span class="math-text">3x</span>, <span class="math-text">-5y</span>, <span class="math-text">7</span>).</p>

                    <h3>2. Variables</h3>
                    <p>A <strong>variable</strong> is a symbol (usually a letter like x, y, a, b) that represents an unknown value.</p>

                    <h3>3. Constants</h3>
                    <p>A <strong>constant</strong> is a number on its own. Its value never changes. In <span class="math-text">2x + 9</span>, the 9 is the constant.</p>

                    <h3>4. Coefficients</h3>
                    <p>The <strong>numerical coefficient</strong> is the number multiplied by the variable.</p>
                    <div style="background:#fff3cd; padding:15px; border-radius:10px; border-left:5px solid #ffc107;">
                        <strong>‚ö†Ô∏è The Invisible 1 Rule:</strong> If a variable has no number (e.g., <span class="math-text">x</span>), the coefficient is <strong>1</strong>. If it is <span class="math-text">-x</span>, the coefficient is <strong>-1</strong>.
                    </div>
                `,
                elaborate: `
                    <h2>üöÄ Elaborate: Advanced Diagnosis</h2>
                    <p>Let's examine complex cases often found in exams.</p>

                    <div class="quiz-item" style="background:white; border:2px solid var(--primary);">
                        <h3>Case 1: The Fraction Disguise</h3>
                        <p><strong>Problem:</strong> Identify parts of <span class="math-text">x/2 - 5</span>.</p>
                        <p><strong>Solution:</strong> Rewrite it as <span class="math-text">1/2 x - 5</span>.</p>
                        <ul>
                            <li>Terms: 2 (<span class="math-text">1/2 x</span> and <span class="math-text">-5</span>)</li>
                            <li>Coefficient: <strong>1/2</strong></li>
                            <li>Constant: <strong>-5</strong></li>
                        </ul>
                    </div>

                    <div class="quiz-item" style="background:white; border:2px solid var(--accent);">
                        <h3>Case 2: Geometry Formulas</h3>
                        <p><strong>Problem:</strong> <span class="math-text">Area = 3œÄr¬≤</span></p>
                        <p><strong>Analysis:</strong></p>
                        <ul>
                            <li>Variable: <strong>r</strong> (radius changes)</li>
                            <li>Constant/Coefficient: <strong>3œÄ</strong> (Since œÄ is a fixed number approx 3.14)</li>
                        </ul>
                    </div>
                `
            },
            2: {
                title: "Language of Algebra",
                intro: `
                    <h1>Level 2: Language of Algebra</h1>
                    <p>Math is a language. Learn to translate English sentences into Math symbols.</p>
                    <div style="background:#e1bee7; padding:20px; border-radius:15px; margin:20px 0;">
                        <h3>üéØ Objectives (Lesson 2)</h3>
                        <ul>
                            <li>Differentiate between <strong>Expression</strong> and <strong>Equation</strong>.</li>
                            <li>Translate phrases using "Switch Words".</li>
                            <li>Use inequality symbols correctly.</li>
                        </ul>
                    </div>
                    <button class="btn" onclick="startLesson(2)">Start Translating ‚û°Ô∏è</button>
                `,
                explain: `
                    <h2>üìö Explain: Translation Rules</h2>
                    <div class="video-container"><iframe src="https://www.youtube.com/embed/Xm8nQm1KKuE" allowfullscreen></iframe></div>

                    <h3>1. Expression vs. Equation</h3>
                    <p><strong>Expression:</strong> A mathematical phrase representing a value. NO equal sign. (e.g., <span class="math-text">3x + 5</span>).</p>
                    <p><strong>Equation:</strong> A sentence stating equality. MUST have an equal sign. (e.g., <span class="math-text">3x + 5 = 10</span>).</p>

                    <h3>2. The "Is" Rule</h3>
                    <p>In math problems, the word "is" almost always means <strong>Equals (=)</strong>.</p>

                    <h3>3. The Switch Words</h3>
                    <p>Phrases like <strong>"Less than"</strong> and <strong>"Subtracted from"</strong> require you to FLIP the order.</p>
                    <ul>
                        <li>"5 less than x" &rarr; <span class="math-text">x - 5</span> (Correct)</li>
                        <li>"5 less than x" &rarr; <span class="math-text">5 - x</span> (Incorrect)</li>
                    </ul>

                    <h3>4. Inequalities</h3>
                    <ul>
                        <li><span class="math-text">&lt;</span> Is less than</li>
                        <li><span class="math-text">&le;</span> Is at most / Maximum</li>
                        <li><span class="math-text">&gt;</span> Is greater than</li>
                        <li><span class="math-text">&ge;</span> Is at least / Minimum</li>
                    </ul>
                `,
                elaborate: `
                    <h2>üöÄ Elaborate: Real World Translation</h2>
                    <div class="quiz-item" style="background:white; border:2px solid var(--primary);">
                        <h3>Scenario 1: Age Problem</h3>
                        <p>"Maria is 5 years younger than twice her brother's age (b)."</p>
                        <p><strong>Translation:</strong> <span class="math-text">2b - 5</span></p>
                        <p><em>Reasoning:</em> "Twice age" is 2b. "Younger than" acts like "less than", so we switch the order (- 5 goes last).</p>
                    </div>

                    <div class="quiz-item" style="background:white; border:2px solid var(--accent);">
                        <h3>Scenario 2: Budget Constraints</h3>
                        <p>"You need at least 100 pesos to enter."</p>
                        <p><strong>Translation:</strong> <span class="math-text">x ‚â• 100</span></p>
                        <p><em>Reasoning:</em> "At least" means 100 is allowed, or anything higher.</p>
                    </div>
                `
            },
            3: {
                title: "Properties of Equality",
                intro: `
                    <h1>Level 3: Properties of Equality</h1>
                    <p>The "Rules of the Road" for moving numbers around.</p>
                    <div style="background:#e1bee7; padding:20px; border-radius:15px; margin:20px 0;">
                        <h3>üéØ Objectives (Lesson 3)</h3>
                        <ul>
                            <li>Identify Commutative, Associative, and Distributive Properties.</li>
                            <li>Apply properties to simplify expressions.</li>
                        </ul>
                    </div>
                    <button class="btn" onclick="startLesson(3)">Learn the Laws ‚û°Ô∏è</button>
                `,
                explain: `
                    <h2>üìö Explain: The Big Three</h2>
                    <div class="video-container"><iframe src="https://www.youtube.com/embed/DKC74YKJpNY" allowfullscreen></iframe></div>

                    <h3>1. Commutative Property (Order)</h3>
                    <p>Changing the <strong>order</strong> of addition or multiplication does not change the result.</p>
                    <p><span class="math-text">a + b = b + a</span></p>

                    <h3>2. Associative Property (Grouping)</h3>
                    <p>Changing the <strong>grouping</strong> (parentheses) does not change the result.</p>
                    <p><span class="math-text">(a + b) + c = a + (b + c)</span></p>

                    <h3>3. Distributive Property</h3>
                    <p>Multiplying a value across a sum.</p>
                    <p><span class="math-text">a(b + c) = ab + ac</span></p>

                    <h3>4. Identity & Inverse</h3>
                    <p><strong>Identity:</strong> 0 (Add) or 1 (Mult). Leaves value unchanged.</p>
                    <p><strong>Inverse:</strong> Opposites (-x) or Reciprocals (1/x). Cancels to identity.</p>
                `,
                elaborate: `
                    <h2>üöÄ Elaborate: The Justification</h2>
                    <p>In higher math, you must justify every step.</p>
                    <div class="quiz-item" style="background:white; border:2px solid var(--primary);">
                        <h3>Problem: Simplify 3(x + 2) + 5</h3>
                        <ol>
                            <li><span class="math-text">3x + 6 + 5</span> (Reason: <strong>Distributive Property</strong>)</li>
                            <li><span class="math-text">3x + (6 + 5)</span> (Reason: <strong>Associative Property</strong>)</li>
                            <li><span class="math-text">3x + 11</span> (Reason: Addition)</li>
                        </ol>
                    </div>
                `
            },
            4: {
                title: "Solving Equations",
                intro: `
                    <h1>Level 4: Solving Equations</h1>
                    <p>The final boss: Finding the Unknown Variable.</p>
                    <div style="background:#e1bee7; padding:20px; border-radius:15px; margin:20px 0;">
                        <h3>üéØ Objectives (Lesson 4)</h3>
                        <ul>
                            <li>Solve equations using APE and MPE.</li>
                            <li>Check solutions.</li>
                        </ul>
                    </div>
                    <button class="btn" onclick="startLesson(4)">Start Solving ‚û°Ô∏è</button>
                `,
                explain: `
                    <h2>üìö Explain: Rules of Equality</h2>
                    <div class="video-container"><iframe src="https://www.youtube.com/embed/1nPsm-kL_Qw" allowfullscreen></iframe></div>

                    <h3>1. The Goal</h3>
                    <p>Isolate the variable (<span class="math-text">x = ___</span>) using <strong>Inverse Operations</strong>.</p>

                    <h3>2. Addition Property of Equality (APE)</h3>
                    <p>Adding/Subtracting the same number to both sides keeps the equation balanced.</p>
                    <p><em>Use:</em> Remove constants added/subtracted to x.</p>

                    <h3>3. Multiplication Property of Equality (MPE)</h3>
                    <p>Multiplying/Dividing both sides by the same number keeps it balanced.</p>
                    <p><em>Use:</em> Remove coefficients.</p>

                    <h3>4. Strategy</h3>
                    <p>Undo Addition/Subtraction <strong>FIRST</strong>, then undo Multiplication/Division.</p>
                `,
                elaborate: `
                    <h2>üöÄ Elaborate: Error Analysis</h2>
                    <div class="quiz-item" style="background:white; border:2px solid var(--error);">
                        <h3>Find the Error</h3>
                        <p><strong>Problem:</strong> <span class="math-text">2x + 4 = 10</span></p>
                        <p><strong>Student Work:</strong></p>
                        <p>Step 1: <span class="math-text">2x = 14</span> (Added 4 instead of Subtracting!)</p>
                        <p>Step 2: <span class="math-text">x = 7</span></p>
                        <hr>
                        <p><strong>Correct Steps:</strong></p>
                        <p>Step 1: Subtract 4 from both sides (<span class="math-text">2x = 6</span>)</p>
                        <p>Step 2: Divide by 2 (<span class="math-text">x = 3</span>)</p>
                    </div>
                `
            }
        },
        games: {
            // LESSON 1 GAMES
            l1_engage: {
                title: "Sentence Dissector",
                desc: "Identify the grammar part (Noun, Adjective) to prepare for Algebra parts.",
                rounds: [
                    { html: `"The <span class='math-text'>blue</span> car"`, q: "The highlighted word is an...", opts: ["Adjective", "Noun"], a: 0 },
                    { html: `"The dog <span class='math-text'>runs</span>"`, q: "The highlighted word is a...", opts: ["Verb", "Noun"], a: 0 },
                    { html: `"<span class='math-text'>5</span> apples"`, q: "The highlighted part is a...", opts: ["Number", "Variable"], a: 0 },
                    { html: `"<span class='math-text'>x</span> apples"`, q: "The highlighted part is a...", opts: ["Variable", "Number"], a: 0 },
                    { html: `"<span class='math-text'>Tall</span> building"`, q: "The highlighted word is an...", opts: ["Adjective", "Verb"], a: 0 }
                ]
            },
            l1_explore: {
                title: "Algebra Autopsy",
                desc: "Click the part of the expression requested.",
                type: "clicker",
                rounds: [
                    { expr: "4x - 9", task: "Click the Coefficient", correct: "4", parts: ["4", "x", "- 9"] },
                    { expr: "3y + 2", task: "Click the Variable", correct: "y", parts: ["3", "y", "+ 2"] },
                    { expr: "a - 5", task: "Click the Constant", correct: "- 5", parts: ["a", "- 5"] },
                    { expr: "-x + 10", task: "Click the Coefficient", correct: "-", parts: ["-", "x", "+ 10"] },
                    { expr: "2œÄr", task: "Click the Constant", correct: "2œÄ", parts: ["2œÄ", "r"] }
                ]
            },
            // LESSON 2 GAMES
            l2_engage: {
                title: "Symbol Speed Match",
                desc: "Match the English phrase to the Math symbol.",
                rounds: [
                    { q: "Increased by", opts: ["+", "-"], a: 0 },
                    { q: "Product of", opts: ["‚Ä¢", "√∑"], a: 0 },
                    { q: "Quotient", opts: ["√∑", "-"], a: 0 },
                    { q: "Is less than", opts: ["<", ">"], a: 0 },
                    { q: "Is at most", opts: ["‚â§", "‚â•"], a: 0 }
                ]
            },
            l2_explore: {
                title: "The Rosetta Stone",
                desc: "Translate the phrase. Watch for switch words!",
                rounds: [
                    { q: "Sum of x and 5", opts: ["x + 5", "5x"], a: 0 },
                    { q: "10 decreased by y", opts: ["10 - y", "y - 10"], a: 0 },
                    { q: "5 less than x (Switch!)", opts: ["x - 5", "5 - x"], a: 0 },
                    { q: "Twice a number", opts: ["2x", "x + 2"], a: 0 },
                    { q: "10 subtracted from z (Switch!)", opts: ["z - 10", "10 - z"], a: 0 }
                ]
            },
            // LESSON 3 GAMES
            l3_engage: {
                title: "Truth Detector",
                desc: "Is the statement True or False?",
                rounds: [
                    { q: "5 + 3 = 3 + 5", opts: ["True", "False"], a: 0 },
                    { q: "5 - 3 = 3 - 5", opts: ["True", "False"], a: 1 },
                    { q: "2(3) = 3(2)", opts: ["True", "False"], a: 0 },
                    { q: "10 √∑ 2 = 2 √∑ 10", opts: ["True", "False"], a: 1 },
                    { q: "(1+2)+3 = 1+(2+3)", opts: ["True", "False"], a: 0 }
                ]
            },
            l3_explore: {
                title: "Property Sorter",
                desc: "Identify the property shown.",
                rounds: [
                    { q: "a + b = b + a", opts: ["Commutative", "Associative"], a: 0 },
                    { q: "3(x + 2) = 3x + 6", opts: ["Distributive", "Identity"], a: 0 },
                    { q: "(a+b)+c = a+(b+c)", opts: ["Associative", "Commutative"], a: 0 },
                    { q: "x + 0 = x", opts: ["Identity", "Inverse"], a: 0 },
                    { q: "5 + (-5) = 0", opts: ["Inverse", "Identity"], a: 0 }
                ]
            },
            // LESSON 4 GAMES
            l4_engage: {
                title: "Balance Scale Logic",
                desc: "Keep the scale balanced.",
                rounds: [
                    { q: "Left: -5. Right must...", opts: ["Subtract 5", "Add 5"], a: 0 },
                    { q: "Left: x2. Right must...", opts: ["Multiply by 2", "Divide by 2"], a: 0 },
                    { q: "Right: +10. Left must...", opts: ["Add 10", "Subtract 10"], a: 0 },
                    { q: "Left: √∑3. Right must...", opts: ["Divide by 3", "Multiply by 3"], a: 0 },
                    { q: "Goal of solving?", opts: ["Isolate Variable", "Remove Variable"], a: 0 }
                ]
            },
            l4_explore: {
                title: "Equation Builder",
                desc: "Reverse engineer the solution.",
                rounds: [
                    { q: "Start: x = 5. Multiply by 3.", opts: ["3x = 15", "x + 3 = 8"], a: 0 },
                    { q: "Start: 3x = 15. Add 2.", opts: ["3x + 2 = 17", "3x = 17"], a: 0 },
                    { q: "Solve 3x + 2 = 17. First step?", opts: ["Subtract 2", "Divide by 3"], a: 0 },
                    { q: "Next step?", opts: ["Divide by 3", "Subtract 2"], a: 0 },
                    { q: "Final Answer?", opts: ["x = 5", "x = 6"], a: 0 }
                ]
            }
        },
        quizzes: {
            1: [
                {q:"Terms in <span class='math-text'>5x - 2y + 8</span>?", opts:["2","3","4"], a:1},
                {q:"Constant in <span class='math-text'>4m - 12</span>?", opts:["4","12","-12"], a:2},
                {q:"Coefficient of <span class='math-text'>-x</span>?", opts:["1","-1","0"], a:1},
                {q:"Variable in <span class='math-text'>3a + 5</span>?", opts:["a","3","5"], a:0},
                {q:"Rewrite <span class='math-text'>y/4</span> coefficient", opts:["4y","1/4","0.4"], a:1},
                {q:"Terms in <span class='math-text'>2x + y - z + 5</span>?", opts:["3","4","5"], a:1},
                {q:"Constant in <span class='math-text'>x</span>?", opts:["0","1","None"], a:2},
                {q:"Coefficient in <span class='math-text'>x</span>?", opts:["1","0","x"], a:0},
                {q:"Variables in <span class='math-text'>2ab + c</span>?", opts:["a,b","a,b,c","c"], a:1},
                {q:"Terms separated by?", opts:["+ / -","* / √∑"], a:0}
            ],
            2: [
                {q:"Is <span class='math-text'>2x+5</span> Exp or Eq?", opts:["Exp","Eq"], a:0},
                {q:"Is <span class='math-text'>x=10</span> Exp or Eq?", opts:["Exp","Eq"], a:1},
                {q:"Translate 'Sum of x and 8'", opts:["x-8","x+8"], a:1},
                {q:"Translate '5 less than y'", opts:["5-y","y-5"], a:1},
                {q:"Symbol 'At most'", opts:["<",">","‚â§"], a:2},
                {q:"Symbol 'Minimum'", opts:[">","‚â•","‚â§"], a:1},
                {q:"'Product' means?", opts:["+","‚Ä¢"], a:1},
                {q:"'Is' means?", opts:["=","<"], a:0},
                {q:"Translate 'Twice x'", opts:["x+2","2x"], a:1},
                {q:"Translate '10 subtracted from z'", opts:["10-z","z-10"], a:1}
            ],
            3: [
                {q:"<span class='math-text'>a+b=b+a</span>", opts:["Comm","Assoc"], a:0},
                {q:"<span class='math-text'>3(x+2)=3x+6</span>", opts:["Dist","Ident"], a:0},
                {q:"<span class='math-text'>(1+2)+3=1+(2+3)</span>", opts:["Assoc","Comm"], a:0},
                {q:"<span class='math-text'>x+0=x</span>", opts:["Ident","Inv"], a:0},
                {q:"<span class='math-text'>5+(-5)=0</span>", opts:["Ident","Inv"], a:1},
                {q:"<span class='math-text'>1*x=x</span>", opts:["Ident","Comm"], a:0},
                {q:"Order matters in?", opts:["Add","Sub"], a:1},
                {q:"Simplify <span class='math-text'>2(x+3)</span>", opts:["2x+3","2x+6"], a:1},
                {q:"<span class='math-text'>xy = yx</span>", opts:["Comm","Assoc"], a:0},
                {q:"Simplify <span class='math-text'>-(x-2)</span>", opts:["-x-2","-x+2"], a:1}
            ],
            4: [
                {q:"Solve <span class='math-text'>x+5=12</span>", opts:["7","17"], a:0},
                {q:"Solve <span class='math-text'>2x=20</span>", opts:["10","40"], a:0},
                {q:"First step <span class='math-text'>2x-5=11</span>", opts:["Add 5","Div 2"], a:0},
                {q:"Solve <span class='math-text'>-x=5</span>", opts:["5","-5"], a:1},
                {q:"Prop for <span class='math-text'>x-3=10</span>", opts:["APE","MPE"], a:0},
                {q:"Prop for <span class='math-text'>3x=12</span>", opts:["APE","MPE"], a:1},
                {q:"Solve <span class='math-text'>x/4=2</span>", opts:["2","8"], a:1},
                {q:"Check x=2 for <span class='math-text'>3x=6</span>", opts:["True","False"], a:0},
                {q:"Solve <span class='math-text'>2x+1=5</span>", opts:["2","3"], a:0},
                {q:"Inverse of Multiply?", opts:["Add","Div"], a:1}
            ]
        }
    };

    /* =========================================
       ENGINE LOGIC
       ========================================= */
    let currentLesson = 1;
    let currentPhase = 'engage';
    let xp = 0;
    let completedLessons = [];
    let gameRound = 0;
    let gameScore = 0;

    function loadHome() {
        document.getElementById('phaseNav').classList.remove('visible');
        document.getElementById('contentArea').innerHTML = content.home;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    }

    function loadLessonIntro(id) {
        currentLesson = id;
        document.getElementById('phaseNav').classList.remove('visible');
        document.getElementById('contentArea').innerHTML = content.lessons[id].intro;
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('nav-'+id).classList.add('active');
        document.getElementById('pBar').style.width = '0%';
    }

    function startLesson(id) {
        document.getElementById('phaseNav').classList.add('visible');
        setPhase('engage');
    }

    function setPhase(p) {
        currentPhase = p;
        const phases = ['engage', 'explore', 'explain', 'elaborate', 'evaluate'];
        document.getElementById('pBar').style.width = `${(phases.indexOf(p)+1)*20}%`;

        document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`button[onclick="setPhase('${p}')"]`).classList.add('active');

        let html = "";
        
        // GAME ENGINE
        if(p === 'engage' || p === 'explore') {
            const gameData = content.games[`l${currentLesson}_${p}`];
            html = `
                <h2>${gameData.title}</h2>
                <p>${gameData.desc}</p>
                <div id="gameBoard" class="game-board"></div>
            `;
            document.getElementById('contentArea').innerHTML = html;
            initGame(p);
        }
        // QUIZ ENGINE
        else if(p === 'evaluate') {
            const quizData = content.quizzes[currentLesson];
            html = `<h2>‚úÖ Evaluate: Mastery Quiz</h2><p>Answer 10 questions to complete the level.</p>`;
            quizData.forEach((q, i) => {
                let opts = q.opts.map((o, oi) => `<span class='quiz-opt' onclick="checkQuiz(this, ${oi}, ${q.a})">${o}</span>`).join('');
                html += `<div class="quiz-item"><p><strong>Q${i+1}:</strong> ${q.q}</p>${opts}</div>`;
            });
            html += `<button class="btn btn-next" onclick="nextPhase()">Finish Level ‚û°Ô∏è</button>`;
            document.getElementById('contentArea').innerHTML = html;
        }
        // CONTENT
        else {
            html = content.lessons[currentLesson][p];
            html += `<button class="btn btn-next" onclick="nextPhase()">Next ‚û°Ô∏è</button>`;
            document.getElementById('contentArea').innerHTML = html;
        }
    }

    function nextPhase() {
        const phases = ['engage', 'explore', 'explain', 'elaborate', 'evaluate'];
        let idx = phases.indexOf(currentPhase);
        if(idx < 4) setPhase(phases[idx+1]);
        else {
            if(!completedLessons.includes(currentLesson)) {
                completedLessons.push(currentLesson);
                document.getElementById('nav-'+currentLesson).classList.add('completed');
                addXP(100);
            }
            if(completedLessons.length === 4) {
                // Show congratulations overlay if all 4 lessons are done
                // Creating overlay element dynamically if not present
                let overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.width = '100%';
                overlay.style.height = '100%';
                overlay.style.background = 'rgba(0,0,0,0.9)';
                overlay.style.color = 'white';
                overlay.style.display = 'flex';
                overlay.style.flexDirection = 'column';
                overlay.style.justifyContent = 'center';
                overlay.style.alignItems = 'center';
                overlay.style.zIndex = '1000';
                overlay.innerHTML = `<h1>üéâ MISSION COMPLETE! üéâ</h1><p style="font-size:2em;">You mastered all 4 levels!</p><button class="btn" onclick="location.reload()">Play Again</button>`;
                document.body.appendChild(overlay);
            } else {
                alert("Level Complete! +100 XP");
                loadHome();
            }
        }
    }

    function addXP(n) { xp += n; document.getElementById('totalXP').innerText = xp; }

    /* =========================================
       GAME FUNCTIONS
       ========================================= */
    function initGame(type) {
        gameRound = 0; gameScore = 0;
        renderGameRound(type);
    }

    function renderGameRound(type) {
        const data = content.games[`l${currentLesson}_${type}`];
        const board = document.getElementById('gameBoard');
        
        if(gameRound >= 5) {
            board.innerHTML = `<h3 style='color:var(--success)'>Stage Complete!</h3><p>Score: ${gameScore}/5</p><button class='btn' onclick="nextPhase()">Continue ‚û°Ô∏è</button>`;
            return;
        }

        const roundData = data.rounds[gameRound];
        let innerHTML = `<div style="margin-bottom:20px; color:#636e72;">Round ${gameRound+1}/5</div>`;

        // CLICKER GAME (L1 Explore)
        if(data.type === 'clicker') {
            innerHTML += `<h3 style="margin-bottom:20px;">Task: ${roundData.task}</h3><div style="font-size:2em;">`;
            roundData.parts.forEach(part => {
                innerHTML += `<span class="highlightable" onclick="checkClicker('${part}', '${roundData.correct}')">${part}</span> `;
            });
            innerHTML += `</div><div id="fb" class="feedback"></div>`;
        } 
        // CHOICE GAME (Standard)
        else {
            innerHTML += `<div class="math-display" style="background:white; color:#2d3436; border:2px solid #dfe6e9;">${roundData.html || roundData.q}</div>`;
            innerHTML += `<div>`;
            roundData.opts.forEach((opt, i) => {
                innerHTML += `<button class="btn btn-outline" onclick="checkChoice(${i}, ${roundData.a}, '${type}')">${opt}</button>`;
            });
            innerHTML += `</div><div id="fb" class="feedback"></div>`;
        }
        board.innerHTML = innerHTML;
    }

    function checkChoice(choice, correct, type) {
        const fb = document.getElementById('fb');
        if(choice === correct) {
            fb.innerText = "Correct! +10 XP"; fb.className = "feedback correct";
            addXP(10); gameScore++;
            setTimeout(() => { gameRound++; renderGameRound(type); }, 1000);
        } else {
            fb.innerText = "Try Again!"; fb.className = "feedback wrong";
        }
    }

    function checkClicker(val, correct) {
        const fb = document.getElementById('fb');
        if(val.trim() === correct.trim()) {
            fb.innerText = "Correct! +10 XP"; fb.className = "feedback correct";
            addXP(10); gameScore++;
            setTimeout(() => { gameRound++; renderGameRound('explore'); }, 1000);
        } else {
            fb.innerText = "Wrong part!"; fb.className = "feedback wrong";
        }
    }

    function checkQuiz(el, choice, correct) {
        const p = el.parentNode;
        p.querySelectorAll('.quiz-opt').forEach(o => o.style.background = 'white');
        if(choice === correct) {
            el.style.background = '#00b894'; el.style.color = 'white'; addXP(20);
        } else {
            el.style.background = '#d63031'; el.style.color = 'white';
        }
    }

    // Init
    loadHome();

</script>
</body>
</html>